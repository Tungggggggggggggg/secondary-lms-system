\documentclass[12pt, a4paper]{report}

% --- UNIVERSAL PREAMBLE BLOCK FOR VIETNAMESE ---
\usepackage[a4paper, top=20mm, bottom=20mm, left=35mm, right=20mm]{geometry}
\usepackage{fontspec}
\usepackage[bidi=basic, provide=*]{babel}

% Cấu hình ngôn ngữ và font chữ (Sử dụng Noto Serif để thay thế Times New Roman trong môi trường này)
\babelprovide[main, import, onchar=ids fonts]{vietnamese}
\babelprovide[import, onchar=ids fonts]{english}

\IfFontExistsTF{Noto Serif}{
\babelfont{rm}{Noto Serif}
\babelfont[vietnamese]{rm}{Noto Serif}
}{
\IfFontExistsTF{Times New Roman}{
\babelfont{rm}{Times New Roman}
\babelfont[vietnamese]{rm}{Times New Roman}
}{
\babelfont{rm}{Latin Modern Roman}
\babelfont[vietnamese]{rm}{Latin Modern Roman}
}
}

% Fix cho danh sách khi sử dụng ngôn ngữ không phải tiếng Anh
\usepackage{enumitem}
\setlist[itemize]{label=-}
% --- GÓI BỔ TRỢ HỌC THUẬT ---
\usepackage{amsmath, amsfonts, amssymb}
\usepackage{graphicx}
\graphicspath{{docs/luanvan/}{docs/luanvan/figures/}{docs/luanvan/figures/uml/}{figures/}{figures/uml/}{uml/}{out/docs/luanvan/figures/}{out/docs/luanvan/figures/uml/}{out/docs/luanvan/figures/uml/usecase-overall/}{out/docs/luanvan/figures/uml/usecase-anti-cheat/}{out/docs/luanvan/figures/uml/sequence-exam-events/}{out/docs/luanvan/figures/uml/activity-suspicious-behavior/}{out/docs/luanvan/figures/uml/context-eduverse/}{out/docs/luanvan/figures/uml/component-architecture/}{out/docs/luanvan/figures/uml/db-core/}}
\usepackage{setspace}
\usepackage{indentfirst}
\usepackage{titlesec}
\usepackage{listings}
\usepackage{color}
\usepackage{booktabs}
\usepackage{caption}
\usepackage{float}
\usepackage{needspace}

% Cấu hình giãn dòng chuẩn luận văn (1.5 line spacing)
\onehalfspacing
\setlength{\parindent}{1.27cm}
\setlength{\emergencystretch}{2em}

% Cấu hình mã nguồn (Code) chuyên nghiệp
\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}

\lstset{
    backgroundcolor=\color{backcolour},   
    commentstyle=\color{codegreen},
    keywordstyle=\color{magenta},
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{codepurple},
    basicstyle=\ttfamily\footnotesize,
    breakatwhitespace=false,         
    breaklines=true,                 
    captionpos=b,                    
    keepspaces=true,                 
    numbers=left,                    
    numbersep=5pt,                  
    showspaces=false,                
    showstringspaces=false,
    showtabs=false,                  
    tabsize=2
}

% Định dạng tiêu đề chương theo chuẩn: CHƯƠNG 1 (Căn giữa, viết hoa)
\titleformat{\chapter}[display]
  {\normalfont\large\bfseries\centering}
  {\MakeUppercase{\chaptername}\ \thechapter}
  {5pt}
  {\large\MakeUppercase}
\titlespacing*{\chapter}{0pt}{-20pt}{30pt}

% Định dạng tiêu đề mục (Section, Subsection)
\titleformat{\section}{\normalfont\normalsize\bfseries}{\thesection}{1em}{}
\titleformat{\subsection}{\normalfont\normalsize\bfseries\itshape}{\thesubsection}{1em}{}

\usepackage{hyperref}
\hypersetup{
    colorlinks=true,
    linkcolor=black,
    filecolor=magenta,      
    urlcolor=blue,
    pdftitle={Luận văn Tốt nghiệp - Smart LMS},
}

\begin{document}

% ======================================================
% TRANG BÌA
% ======================================================
\begin{titlepage}
    \centering
    {\large \textbf{BỘ GIÁO DỤC VÀ ĐÀO TẠO}} \\
    {\large \textbf{TRƯỜNG ĐẠI HỌC GIAO THÔNG VẬN TẢI TP.HCM}} \\
    {\large \textbf{KHOA CÔNG NGHỆ THÔNG TIN}}
    
    \vspace{1.5cm}
    \begin{figure}[h]
      \centering
      \IfFileExists{docs/luanvan/figures/uth-logo.png}{
        \includegraphics[width=0.35\textwidth]{docs/luanvan/figures/uth-logo.png}
      }{
        \IfFileExists{figures/uth-logo.png}{
          \includegraphics[width=0.35\textwidth]{figures/uth-logo.png}
        }{
          \framebox{\parbox{0.35\textwidth}{\centering
            \vspace{1cm}
            \textbf{LOGO TRƯỜNG} \\
            \small\textit{(Image Placeholder)}
            \vspace{1cm}
          }}
        }
      }
    \end{figure}
    
    \vspace{1.5cm}
    {\Large \textbf{LUẬN VĂN TỐT NGHIỆP ĐẠI HỌC}} \\
    
    \vspace{1cm}
    \begin{spacing}{1.5}
        {\huge \textbf{NGHIÊN CỨU VÀ XÂY DỰNG HỆ THỐNG QUẢN LÝ HỌC TẬP THÔNG MINH (SMART LMS) DỰA TRÊN KIẾN TRÚC RAG VÀ MÔ HÌNH NGÔN NGỮ LỚN}}
    \end{spacing}
    
    \vspace{2cm}
    \begin{flushright}
        \begin{tabular}{l p{6cm}}
            \textbf{Giảng viên hướng dẫn:} & \textbf{TS. Nguyễn Văn B} \\
            \textbf{Sinh viên thực hiện:}     & \textbf{Nguyễn Quốc Tùnggggg} \\
            \textbf{Mã số sinh viên:}         & \textbf{2251120259} \\
            \textbf{Lớp:}                     & \textbf{CN22E}
        \end{tabular}
    \end{flushright}

    \vfill
    {\large \textbf{TP. HỒ CHÍ MINH, NĂM 2025}}
\end{titlepage}

% ======================================================
% PHẦN TRƯỚC NỘI DUNG CHÍNH
% ======================================================
\pagenumbering{roman}

\chapter*{Lời cam đoan}
\addcontentsline{toc}{chapter}{Lời cam đoan}
Tôi xin cam đoan đây là công trình nghiên cứu của riêng tôi dước sự hướng dẫn của giảng viên hướng dẫn. Các kết quả nêu trong luận văn là trung thực và chưa từng được công bố trong bất kỳ công trình nào khác. Mọi sự giúp đỡ cho việc thực hiện luận văn này đã được cảm ơn và các thông tin trích dẫn trong luận văn đã được chỉ rõ nguồn gốc.

\chapter*{Lời mở đầu}
\addcontentsline{toc}{chapter}{Lời mở đầu}
Sự bùng nổ của Trí tuệ nhân tạo tạo sinh (Generative AI) đã mở ra những cơ hội chưa từng có trong việc cá nhân hóa giáo dục. Tuy nhiên, các hệ thống Quản lý học tập (LMS) hiện nay tại Việt Nam chủ yếu vẫn đóng vai trò là kho lưu trữ tài liệu tĩnh, thiếu đi tính tương tác thông minh và khả năng hỗ trợ học sinh học tập chủ động.

Dự án này được thực hiện với mong muốn xây dựng một hệ sinh thái học tập "Smart LMS" dành cho cấp trung học. Điểm đột phá của hệ thống là việc ứng dụng kỹ thuật Retrieval-Augmented Generation (RAG) để tạo ra một Trợ lý ảo (AI Tutor) có khả năng hiểu sâu sắc nội dung bài giảng của giáo viên, từ đó phản hồi chính xác thắc mắc của học sinh. Bên cạnh đó, hệ thống tích hợp các công cụ giám sát thi cử dựa trên AI nhằm đảm bảo tính liêm chính trong môi trường học tập trực tuyến.

\newpage
\tableofcontents 
\newpage
\listoffigures
\newpage
\listoftables

% ======================================================
% CHƯƠNG 1: MỞ ĐẦU
% ======================================================
\newpage
\pagenumbering{arabic}
\chapter{MỞ ĐẦU}

\section{Lý do chọn đề tài}
Trong kỷ nguyên giáo dục 4.0, vai trò của giáo viên đang dịch chuyển từ người truyền thụ kiến thức sang người điều phối học tập. Tuy nhiên, khối lượng công việc hành chính và việc theo sát từng học sinh trong lớp học trực tuyến là một thách thức lớn. Hệ thống LMS thông minh cần phải giải quyết được bài toán giảm tải cho giáo viên và tăng tính tự học cho học sinh.

\section{Mục tiêu nghiên cứu}
\begin{itemize}
    \item Thiết kế kiến trúc hệ thống LMS đa vai trò (Admin, Teacher, Student, Parent).
    \item Hiện thực hóa module AI Tutor hỗ trợ học tập dựa trên cơ sở dữ liệu vector.
    \item Xây dựng quy trình tự động hóa đánh giá năng lực học sinh qua AI.
    \item Đảm bảo an ninh và tính liêm chính học thuật qua hệ thống chống gian lận.
\end{itemize}

\section{Đối tượng và phạm vi nghiên cứu}
\begin{itemize}
    \item \textbf{Đối tượng:} Quy trình quản lý và hỗ trợ học tập tại các trường trung học.
    \item \textbf{Phạm vi:} Xây dựng ứng dụng Web dựa trên Next.js và tích hợp Google Gemini API.
\end{itemize}

% ======================================================
% CHƯƠNG 2: CƠ SỞ LÝ THUYẾT VÀ CÔNG NGHỆ
% ======================================================
\chapter{CƠ SỞ LÝ THUYẾT VÀ CÔNG NGHỆ}

\section{Tổng quan nền tảng công nghệ}
Hệ thống \textbf{EduVerse} được hiện thực hóa dước dạng ứng dụng Web theo mô hình full-stack, trong đó lớp giao diện và lớp xử lý nghiệp vụ (API) được tổ chức thống nhất. Nhóm công nghệ trọng tâm gồm: Next.js (App Router) cho kiến trúc web hiện đại \cite{nextjs}, NextAuth.js cho xác thực và quản lý phiên đăng nhập \cite{nextauth}, Prisma ORM cho truy cập dữ liệu \cite{prisma}, PostgreSQL cho lưu trữ quan hệ \cite{postgresql}, pgvector cho truy xuất tương đồng vector phục vụ RAG \cite{pgvector}, Supabase Storage cho lưu trữ tệp nộp bài \cite{supabase}, và Gemini API cho các tác vụ AI (embedding và sinh nội dung) \cite{gemini}.

\begin{table}[htbp]
\centering
\small
\begin{tabular}{|p{3.2cm}|p{5.2cm}|p{5.2cm}|}
\hline
\textbf{Công nghệ} & \textbf{Vai trò trong hệ thống} & \textbf{Lý do lựa chọn} \\ \hline
Next.js (App Router) \cite{nextjs} & Full-stack Web framework; tổ chức routing, rendering, API Routes & Hỗ trợ kiến trúc hiện đại, tối ưu hiệu năng và bảo mật khi triển khai logic phía server \\ \hline
NextAuth.js \cite{nextauth} & Xác thực người dùng, quản lý phiên đăng nhập & Tích hợp đăng nhập linh hoạt, đồng thời hỗ trợ quản lý session/role cho phân quyền \\ \hline
Prisma ORM \cite{prisma} & Truy cập dữ liệu type-safe, migrations, ánh xạ mô hình dữ liệu & Giảm lỗi truy vấn, tăng tính nhất quán và hỗ trợ mở rộng schema có kiểm soát \\ \hline
PostgreSQL \cite{postgresql} & Cơ sở dữ liệu quan hệ lưu dữ liệu nghiệp vụ & Đảm bảo ACID, ổn định và phù hợp dữ liệu có quan hệ phức tạp (khóa học, bài tập, sự kiện thi) \\ \hline
pgvector \cite{pgvector} & Lưu embedding và truy vấn tương đồng vector phục vụ RAG & Cho phép truy xuất ngữ nghĩa ngay trên Postgres, thống nhất hạ tầng dữ liệu \\ \hline
Supabase Storage \cite{supabase} & Lưu trữ tệp nộp bài, cấp signed URL & Tách tải lưu trữ file khỏi DB, hỗ trợ truy cập an toàn theo thời hạn \\ \hline
Gemini API \cite{gemini} & Tạo embedding và sinh nội dung (AI Tutor, tóm tắt hỗ trợ) & Khả năng sinh ngôn ngữ tự nhiên và tạo embedding phục vụ truy xuất/giải thích \\ \hline
\end{tabular}
\caption{Tóm tắt công nghệ sử dụng trong hệ thống EduVerse}
\end{table}

\begin{table}[htbp]
\centering
\small
\begin{tabular}{|p{3cm}|p{5.3cm}|p{5.3cm}|}
\hline
\textbf{Tiêu chí} & \textbf{RAG \cite{rag}} & \textbf{LLM thuần} \\ \hline
Nguồn tri thức & Dựa trên tài liệu nội bộ (bài giảng) được truy xuất theo câu hỏi & Chủ yếu dựa trên tri thức đã học trong quá trình huấn luyện \\ \hline
Tính kiểm chứng & Có thể truy vết theo đoạn truy xuất; dễ giải thích tại sao trả lời như vậy & Khó truy vết nguồn; dễ sinh nội dung không có trong tài liệu \\ \hline
Rủi ro "ảo giác" & Thấp hơn do bị ràng buộc bởi ngữ cảnh truy xuất & Cao hơn, đặc biệt với câu hỏi đặc thù nội dung lớp học \\ \hline
Chi phí cập nhật tri thức & Cập nhật bằng cách thay tài liệu/embedding (không cần huấn luyện lại) & Thường cần fine-tune hoặc chờ model mới để cập nhật tri thức \\ \hline
Phù hợp giáo dục & Phù hợp khi cần bám sát học liệu và chuẩn hóa nội dung & Phù hợp cho gợi ý chung, nhưng cần kiểm soát chặt khi dùng như nguồn kiến thức \\ \hline
\end{tabular}
\caption{So sánh RAG và LLM thuần trong bối cảnh hệ thống học tập}
\end{table}

\section{Kiến trúc tổng thể hệ thống}
Về mặt kiến trúc, EduVerse có thể xem như một hệ thống gồm bốn lớp chính:
\begin{itemize}
    \item \textbf{Lớp giao diện (Presentation):} các trang dashboard cho học sinh/giáo viên, tập trung vào thao tác học tập, làm bài và theo dõi kết quả.
    \item \textbf{Lớp dịch vụ ứng dụng (Application/API):} các API Routes xử lý nghiệp vụ (xác thực, nộp bài, ghi sự kiện thi, gọi AI Tutor, tóm tắt chống gian lận), đóng vai trò ranh giới bảo mật và kiểm soát truy cập.
    \item \textbf{Lớp dữ liệu (Data):} PostgreSQL lưu dữ liệu quan hệ, kết hợp pgvector để truy vấn vector; Supabase Storage lưu tệp đính kèm.
    \item \textbf{Lớp dịch vụ AI (External AI Service):} Gemini API đảm nhiệm embedding và sinh phản hồi.
\end{itemize}
Trong bối cảnh Next.js, các API Routes và logic truy xuất dữ liệu được thực thi phía server, giúp đảm bảo các tác vụ nhạy cảm (khoá API, truy vấn dữ liệu) không bị lộ ra phía client \cite{nextjs}.

\section{Kiến trúc Web: Next.js App Router và React}
Next.js App Router cung cấp cơ chế định tuyến theo thư mục và hỗ trợ Server Components, giúp tách bạch phần render phía server và tương tác phía client. Trong EduVerse, API Routes được dùng để đóng gói các nghiệp vụ nhạy cảm (ví dụ gọi AI, truy cập cơ sở dữ liệu), qua đó hạn chế lộ khóa dịch vụ và giảm tải cho phía client \cite{nextjs}.

Ở cấp độ triển khai, App Router giúp thống nhất các luồng:
\begin{itemize}
    \item \textbf{SSR/Server Components:} phù hợp khi cần render dữ liệu theo người dùng (ví dụ thông tin lớp học, bài tập), giảm thời gian chờ nhờ trả về HTML đã có dữ liệu.
    \item \textbf{Client Components:} xử lý tương tác trực tiếp (làm bài kiểm tra, thao tác nộp bài, theo dõi trạng thái) và các hành vi cần bắt sự kiện theo thời gian thực.
    \item \textbf{API Routes:} cung cấp endpoint thống nhất cho client, đồng thời là nơi áp dụng các chính sách bảo mật (xác thực, phân quyền, giới hạn tần suất).
\end{itemize}

\section{Xác thực và phân quyền: NextAuth.js}
Hệ thống sử dụng NextAuth.js để hiện thực hóa đăng nhập và quản lý phiên làm việc của người dùng. Cách tiếp cận này cho phép tích hợp nhiều nhà cung cấp đăng nhập (ví dụ OAuth) và đồng thời hỗ trợ cơ chế Credentials khi cần. Dữ liệu phiên (session) được sử dụng để thực thi phân quyền theo vai trò (giáo viên, học sinh, quản trị, phụ huynh) trong các API và luồng điều hướng \cite{nextauth}.

Về mô hình triển khai, NextAuth.js cung cấp cơ chế quản lý phiên dựa trên JWT hoặc session lưu trong cơ sở dữ liệu. Khi người dùng đăng nhập, hệ thống tạo thông tin phiên để:
\begin{itemize}
    \item định danh người dùng (id/email);
    \item gắn \textbf{vai trò (role)} để kiểm soát truy cập chức năng;
    \item đảm bảo tính nhất quán khi truy cập các API Routes.
\end{itemize}

\subsection{Phân quyền theo vai trò (RBAC) và bảo vệ truy cập}
EduVerse áp dụng RBAC (Role-Based Access Control) để tách biệt quyền truy cập giữa học sinh và giáo viên, đặc biệt với các chức năng nhạy cảm như xem sự kiện thi, tạo cấu hình chống gian lận, hoặc gọi API tóm tắt chống gian lận. Trong kiến trúc Next.js, phân quyền có thể được thực thi đồng thời ở:
\begin{itemize}
    \item \textbf{Tầng điều hướng (middleware):} chặn truy cập sớm vào các tuyến không phù hợp với vai trò.
    \item \textbf{Tầng API Routes:} kiểm tra phiên/role trước khi truy vấn dữ liệu hoặc trả kết quả.
\end{itemize}
Cách tiếp cận phòng thủ nhiều lớp (defense in depth) giúp giảm rủi ro truy cập trái phép ngay cả khi client bị giả mạo \cite{nextjs,nextauth}.

\section{Tầng dữ liệu: Prisma ORM và PostgreSQL}
Prisma đóng vai trò lớp ánh xạ đối tượng--quan hệ (ORM), giúp truy cập dữ liệu thông qua client kiểu tĩnh (type-safe) trong TypeScript, giảm lỗi truy vấn và tăng tính nhất quán khi phát triển \cite{prisma}. Dữ liệu nghiệp vụ cốt lõi (người dùng, khóa học/bài học, bài tập, lần làm bài, sự kiện thi) được lưu trong PostgreSQL nhờ đặc tính ACID, khả năng mở rộng và hệ sinh thái phong phú \cite{postgresql}.

\section{Cơ sở dữ liệu vector: pgvector}
Để phục vụ truy xuất ngữ nghĩa cho AI Tutor, EduVerse lưu trữ embedding dước dạng vector trong PostgreSQL thông qua phần mở rộng pgvector \cite{pgvector}. Việc lưu vector cùng hệ quản trị quan hệ giúp thống nhất hạ tầng dữ liệu, đồng thời cho phép truy vấn tương đồng (similarity search) trực tiếp trên cùng một nguồn dữ liệu.

\section{Lưu trữ tệp: Supabase Storage}
Đối với các bài nộp dạng tệp (ví dụ bài tự luận đính kèm), hệ thống sử dụng Supabase Storage để lưu trữ và cấp phát liên kết truy cập an toàn theo thời hạn (signed URL) \cite{supabase}.

\section{Mô hình ngôn ngữ lớn (LLM) và Gemini API}
Gemini API được dùng cho hai nhóm tác vụ: (i) \textbf{tạo embedding} cho tài liệu bài giảng và câu hỏi của học sinh, và (ii) \textbf{sinh câu trả lời} dựa trên ngữ cảnh được truy xuất \cite{gemini}.

\section{Kiến trúc RAG (Retrieval-Augmented Generation)}
RAG là nền tảng kỹ thuật của AI Tutor, kết hợp truy xuất tri thức từ nguồn dữ liệu nội bộ và sinh câu trả lời bằng mô hình ngôn ngữ. So với cách chỉ dùng LLM thuần túy, RAG giúp giảm hiện tượng "ảo giác" và tăng khả năng kiểm chứng nhờ bám theo tài liệu bài giảng \cite{rag}.

\section{Ứng dụng AI trong giám sát thi}
Ngoài AI Tutor, Gemini còn có thể được sử dụng để \textbf{tóm tắt tín hiệu chống gian lận} dựa trên nhật ký sự kiện thi, giúp giáo viên giảm tải khi phải xem nhiều log.

% ======================================================
% CHƯƠNG 3: PHÂN TÍCH VÀ THIẾT KẾ HỆ THỐNG
% ======================================================
\chapter{PHÂN TÍCH VÀ THIẾT KẾ HỆ THỐNG}

\section{Giới thiệu chương}
 Chương 3 trình bày phân tích và thiết kế hệ thống \textbf{EduVerse} dựa trên hiện thực triển khai. Nội dung tập trung làm rõ đối tượng sử dụng, yêu cầu chức năng/phi chức năng và thiết kế các thành phần cốt lõi. Trọng tâm thiết kế được nhấn mạnh ở hai mô-đun: \textbf{AI Tutor theo kiến trúc RAG} và \textbf{giám sát thi/chống gian lận dựa trên event log kết hợp AI tổng hợp}.

\section{Phân tích hệ thống}
\subsection{Đối tượng sử dụng (Actor) và vai trò (Role)}
 EduVerse phục vụ các tác nhân chính:
\begin{itemize}
    \item \textbf{Học sinh (STUDENT):} tham gia lớp, học bài, làm bài tập/kiểm tra, tương tác AI Tutor.
    \item \textbf{Giáo viên (TEACHER):} tạo lớp, quản lý khóa học/bài học, tạo bài tập (Quiz/Essay), theo dõi tiến độ và giám sát thi.
    \item \textbf{Phụ huynh (PARENT):} liên kết với học sinh, theo dõi tiến độ/kết quả và nhận tóm tắt định kỳ.
    \item \textbf{Quản trị viên (ADMIN):} quản trị người dùng và cấu hình hệ thống; theo dõi nhật ký hoạt động.
\end{itemize}

\subsection{Yêu cầu chức năng}
 Các yêu cầu chức năng được mô tả theo tác nhân sử dụng chính như sau:
 \begin{itemize}
     \item \textbf{Khách (chưa đăng nhập):} đăng ký, đăng nhập, quên/đặt lại mật khẩu.
     \item \textbf{Học sinh:} tham gia lớp; xem bài học và học liệu; làm bài (quiz/essay); nộp bài; nhận thông báo; nhắn tin; tương tác AI Tutor.
     \item \textbf{Giáo viên:} tạo và quản lý lớp học; quản lý khóa học/bài học; tạo bài tập/đề kiểm tra; theo dõi tiến độ và kết quả; giám sát thi dựa trên event log và nhận hỗ trợ tổng hợp bằng AI.
     \item \textbf{Phụ huynh:} liên kết với học sinh; theo dõi tiến độ/kết quả; trao đổi với giáo viên.
     \item \textbf{Quản trị viên:} quản trị người dùng và cấu hình hệ thống; theo dõi nhật ký hoạt động.
 \end{itemize}

\subsection{Yêu cầu phi chức năng}
\begin{itemize}
    \item \textbf{Bảo mật và phân quyền:} hệ thống dùng NextAuth (JWT strategy) và middleware điều hướng/phân quyền theo role; các API nhạy cảm giới hạn theo vai trò (ví dụ: teacher-only, admin-only) \cite{nextauth}.
    \item \textbf{Kiểm soát lạm dụng (rate limit):} các API nhạy cảm (reset password, AI Tutor, AI anti-cheat, cập nhật cấu hình hệ thống) áp dụng rate limit theo IP và/hoặc user.
    \item \textbf{Khả năng truy vết:} hệ thống ghi audit log cho các hành vi quan trọng và lưu event log cho giám sát thi.
\end{itemize}

\section{Thiết kế hệ thống}
\subsection{Thiết kế kiến trúc}
 EduVerse triển khai theo mô hình \textbf{Client--Server} trong một codebase Next.js: client UI gửi request đến API Routes; API Routes thực thi nghiệp vụ, truy cập dữ liệu qua Prisma và gọi dịch vụ AI.

\begin{figure}[H]
    \centering
    \IfFileExists{../out/docs/luanvan/figures/uml/context-eduverse/EduVerse_System_Context.png}{
        \includegraphics[width=0.95\textwidth]{../out/docs/luanvan/figures/uml/context-eduverse/EduVerse_System_Context.png}
    }{
        \IfFileExists{out/docs/luanvan/figures/uml/context-eduverse/EduVerse_System_Context.png}{
            \includegraphics[width=0.95\textwidth]{out/docs/luanvan/figures/uml/context-eduverse/EduVerse_System_Context.png}
        }{
            \IfFileExists{docs/luanvan/figures/uml/EduVerse_System_Context.png}{
                \includegraphics[width=0.95\textwidth]{docs/luanvan/figures/uml/EduVerse_System_Context.png}
            }{
                \IfFileExists{figures/uml/EduVerse_System_Context.png}{
                    \includegraphics[width=0.95\textwidth]{figures/uml/EduVerse_System_Context.png}
                }{
                    \framebox{\parbox{0.95\textwidth}{\centering\vspace{1cm}Context Diagram (PlantUML PNG)\vspace{1cm}}}
                }
            }
        }
    }
    \caption{Sơ đồ bối cảnh hệ thống EduVerse}
    \label{fig:context-eduverse}
\end{figure}

\begin{figure}[H]
    \centering
    \IfFileExists{../out/docs/luanvan/figures/uml/component-architecture/EduVerse_Component_Architecture.png}{
        \includegraphics[width=0.95\textwidth]{../out/docs/luanvan/figures/uml/component-architecture/EduVerse_Component_Architecture.png}
    }{
        \IfFileExists{out/docs/luanvan/figures/uml/component-architecture/EduVerse_Component_Architecture.png}{
            \includegraphics[width=0.95\textwidth]{out/docs/luanvan/figures/uml/component-architecture/EduVerse_Component_Architecture.png}
        }{
            \IfFileExists{docs/luanvan/figures/uml/EduVerse_Component_Architecture.png}{
                \includegraphics[width=0.95\textwidth]{docs/luanvan/figures/uml/EduVerse_Component_Architecture.png}
            }{
                \IfFileExists{figures/uml/EduVerse_Component_Architecture.png}{
                    \includegraphics[width=0.95\textwidth]{figures/uml/EduVerse_Component_Architecture.png}
                }{
                    \framebox{\parbox{0.95\textwidth}{\centering\vspace{1cm}Component/Architecture Diagram (PlantUML PNG)\vspace{1cm}}}
                }
            }
        }
    }
    \caption{Kiến trúc tổng thể hệ thống EduVerse}
    \label{fig:component-architecture}
\end{figure}

\subsection{Thiết kế Use Case}
\Needspace{0.9\textheight}
\subsubsection{Use Case tổng thể hệ thống}
\begin{figure}[H]
    \centering
    \IfFileExists{../out/docs/luanvan/figures/uml/usecase-overall/usecase-overall.png}{
        \includegraphics[width=0.95\textwidth,height=0.85\textheight,keepaspectratio]{../out/docs/luanvan/figures/uml/usecase-overall/usecase-overall.png}
    }{
        \IfFileExists{out/docs/luanvan/figures/uml/usecase-overall/usecase-overall.png}{
            \includegraphics[width=0.95\textwidth,height=0.85\textheight,keepaspectratio]{out/docs/luanvan/figures/uml/usecase-overall/usecase-overall.png}
        }{
            \IfFileExists{docs/luanvan/figures/uml/usecase-overall.png}{
                \includegraphics[width=0.95\textwidth,height=0.85\textheight,keepaspectratio]{docs/luanvan/figures/uml/usecase-overall.png}
            }{
                \IfFileExists{figures/uml/usecase-overall.png}{
                    \includegraphics[width=0.95\textwidth,height=0.85\textheight,keepaspectratio]{figures/uml/usecase-overall.png}
                }{
                    \framebox{\parbox{0.95\textwidth}{\centering\vspace{1cm}Use Case Diagram (PlantUML PNG)\vspace{1cm}}}
                }
            }
        }
    }
    \caption{Use Case tổng thể hệ thống EduVerse}
    \label{fig:usecase-overall}
\end{figure}

\Needspace{0.9\textheight}
\subsubsection{Use Case module giám sát thi và chống gian lận}
\begin{figure}[H]
    \centering
    \IfFileExists{../out/docs/luanvan/figures/uml/usecase-anti-cheat/usecase-anti-cheat.png}{
        \includegraphics[width=0.95\textwidth,height=0.85\textheight,keepaspectratio]{../out/docs/luanvan/figures/uml/usecase-anti-cheat/usecase-anti-cheat.png}
    }{
        \IfFileExists{out/docs/luanvan/figures/uml/usecase-anti-cheat/usecase-anti-cheat.png}{
            \includegraphics[width=0.95\textwidth,height=0.85\textheight,keepaspectratio]{out/docs/luanvan/figures/uml/usecase-anti-cheat/usecase-anti-cheat.png}
        }{
            \IfFileExists{docs/luanvan/figures/uml/usecase-anti-cheat.png}{
                \includegraphics[width=0.95\textwidth,height=0.85\textheight,keepaspectratio]{docs/luanvan/figures/uml/usecase-anti-cheat.png}
            }{
                \IfFileExists{figures/uml/usecase-anti-cheat.png}{
                    \includegraphics[width=0.95\textwidth,height=0.85\textheight,keepaspectratio]{figures/uml/usecase-anti-cheat.png}
                }{
                    \framebox{\parbox{0.95\textwidth}{\centering\vspace{1cm}Use Case Diagram (PlantUML PNG)\vspace{1cm}}}
                }
            }
        }
    }
    \caption{Use Case tổng quan module giám sát thi và chống gian lận}
    \label{fig:usecase-anti-cheat}
\end{figure}

\subsection{Thiết kế cơ sở dữ liệu}
Hệ thống sử dụng Prisma ORM kết nối PostgreSQL \cite{prisma,postgresql}. Hình \ref{fig:db-core} minh họa mối quan hệ giữa các thực thể dữ liệu cốt lõi; Bảng \ref{tab:db-core} tóm tắt các nhóm dữ liệu và vai trò tương ứng.

\begin{figure}[H]
    \centering
    \IfFileExists{docs/luanvan/figures/uml/EduVerse_DB_Core.png}{
        \includegraphics[height=0.9\textheight,keepaspectratio]{docs/luanvan/figures/uml/EduVerse_DB_Core.png}
    }{
        \IfFileExists{figures/uml/EduVerse_DB_Core.png}{
            \includegraphics[height=0.9\textheight,keepaspectratio]{figures/uml/EduVerse_DB_Core.png}
        }{
            \IfFileExists{../../out/docs/luanvan/figures/uml/db-core/EduVerse_DB_Core.png}{
                \includegraphics[height=0.9\textheight,keepaspectratio]{../../out/docs/luanvan/figures/uml/db-core/EduVerse_DB_Core.png}
            }{
                \IfFileExists{../out/docs/luanvan/figures/uml/db-core/EduVerse_DB_Core.png}{
                    \includegraphics[height=0.9\textheight,keepaspectratio]{../out/docs/luanvan/figures/uml/db-core/EduVerse_DB_Core.png}
                }{
                    \IfFileExists{out/docs/luanvan/figures/uml/db-core/EduVerse_DB_Core.png}{
                        \includegraphics[height=0.9\textheight,keepaspectratio]{out/docs/luanvan/figures/uml/db-core/EduVerse_DB_Core.png}
                    }{
                        \framebox{\parbox{0.95\textwidth}{\centering\vspace{1cm}Database Diagram (PlantUML PNG)\vspace{1cm}}}
                    }
                }
            }
        }
    }
    \caption{Sơ đồ cơ sở dữ liệu cốt lõi của hệ thống EduVerse}
    \label{fig:db-core}
\end{figure}

\begin{table}[H]
\centering
\small
\begin{tabular}{|p{3.2cm}|p{11.7cm}|}
\hline
\textbf{Nhóm dữ liệu} & \textbf{Vai trò} \\ \hline
Người dùng & Các bảng: \texttt{users} (\texttt{User}). Lưu thông tin tài khoản, vai trò (\texttt{UserRole}), thời điểm chọn vai trò (\texttt{roleSelectedAt}). \\ \hline
Khôi phục mật khẩu & Các bảng: \texttt{password\_resets} (\texttt{PasswordReset}). Lưu mã xác nhận đặt lại mật khẩu, thời hạn (\texttt{expires}) và trạng thái hoàn thành (\texttt{completed}). \\ \hline
Lớp học & Các bảng: \texttt{classrooms}, \texttt{classroom\_students}. Tổ chức lớp học, liên kết học sinh--lớp. \\ \hline
Khóa học/bài học & Các bảng: \texttt{courses}, \texttt{lessons}, \texttt{lesson\_attachments}. Lưu nội dung bài học và tệp đính kèm; là nguồn tri thức cho RAG Tutor. \\ \hline
RAG embedding & Bảng: \texttt{lesson\_embedding\_chunks}. Lưu các đoạn (chunk) đã embedding bằng pgvector để truy vấn tương đồng theo Top-$k$ \cite{pgvector}. \\ \hline
Bài tập/quiz & Các bảng: \texttt{assignments}, \texttt{questions}, \texttt{question\_options}. Lưu bài tập dạng ESSAY/QUIZ, cấu trúc câu hỏi và đáp án. \\ \hline
Nộp bài (ESSAY) & Bảng: \texttt{assignment\_submissions}. Lưu bài tự luận dạng nội dung, điểm và phản hồi. \\ \hline
Nộp bài (tệp) & Các bảng: \texttt{submissions}, \texttt{submission\_files}. Lưu metadata tệp nộp bài (\texttt{storagePath}, \texttt{mimeType}, \texttt{sizeBytes}). \\ \hline
Giám sát thi & Các bảng: \texttt{exam\_events}, \texttt{assignment\_attempts}. Lưu nhật ký sự kiện thi (event log) và thông tin attempt. \\ \hline
Chat & Các bảng: \texttt{conversations}, \texttt{conversation\_participants}, \texttt{messages}, \texttt{chat\_attachments}. Lưu hội thoại và tin nhắn. \\ \hline
Hệ thống/Audit & Các bảng: \texttt{system\_settings}, \texttt{audit\_logs}. Lưu cấu hình hệ thống và nhật ký hoạt động phục vụ truy vết. \\ \hline
\end{tabular}
\caption{Các bảng dữ liệu cốt lõi trong hệ thống EduVerse }
\label{tab:db-core}
\end{table}



% ======================================================
% CHƯƠNG 4: HIỆN THỰC HÓA HỆ THỐNG
% ======================================================
\chapter{HIỆN THỰC HÓA HỆ THỐNG}

\section{Xây dựng trợ lý ảo AI Tutor}
Mô tả cơ chế chỉ mục hóa bài học và truy vấn ngữ nghĩa phục vụ AI Tutor. Cơ chế này khai thác \texttt{pgvector} trên PostgreSQL để lưu trữ và truy vấn vector embedding.

\section{Hệ thống đánh giá và giám sát thi cử}
\subsection{Cơ chế tự động chấm bài}
Kỹ thuật Prompt Engineering được sử dụng để hướng dẫn Gemini chấm bài tự luận dựa trên Rubric do giáo viên cung cấp.
\subsection{Phát hiện hành vi đáng ngờ}
Phân tích logic trong \texttt{suspicious-behavior.ts}: Theo dõi chuyển đổi Tab, phím tắt cấm và mất kết nối.

\section{Giao diện người dùng (UI/UX)}
Sử dụng Tailwind CSS và các thành phần từ Shadcn UI để tạo ra một giao diện tối giản, tập trung vào trải nghiệm học tập (Learning-centric design).

% ======================================================
% CHƯƠNG 5: ĐÁNH GIÁ VÀ THỬ NGHIỆM
% ======================================================
\chapter{ĐÁNH GIÁ VÀ THỬ NGHIỆM}

\section{Đánh giá độ chính xác của AI Tutor}
Thử nghiệm với các bộ câu hỏi mẫu và so sánh câu trả lời của AI với nội dung bài giảng thực tế.

\section{Đánh giá hiệu năng hệ thống}
Phân tích thời gian phản hồi khi truy xuất Vector và khả năng chịu tải của API Routes.

% ======================================================
% CHƯƠNG 6: KẾT LUẬN VÀ HƯỚNG PHÁT TRIỂN
% ======================================================
\chapter{KẾT LUẬN VÀ HƯỚNG PHÁT TRIỂN}

\section{Kết quả đạt được}
Hệ thống đã giải quyết được vấn đề cá nhân hóa hỗ trợ học tập và giúp giáo viên tự động hóa các công việc lặp đi lặp lại.

\section{Hướng phát triển tương lai}
Tích hợp nhận diện khuôn mặt để xác thực danh tính học sinh khi thi và mở rộng ứng dụng trên nền tảng di động.

% ======================================================
% TÀI LIỆU THAM KHẢO
% ======================================================
\begin{thebibliography}{99}
\addcontentsline{toc}{chapter}{Tài liệu tham khảo}
\bibitem{nextjs} Vercel, "Next.js 14 Documentation," 2024. [Online]. Available: \url{https://nextjs.org/docs}.
\bibitem{nextauth} NextAuth.js, "NextAuth.js Documentation," 2024. [Online]. Available: \url{https://next-auth.js.org}.
\bibitem{prisma} Prisma, "Prisma Documentation," 2024. [Online]. Available: \url{https://www.prisma.io/docs}.
\bibitem{postgresql} The PostgreSQL Global Development Group, "PostgreSQL Documentation," 2024. [Online]. Available: \url{https://www.postgresql.org/docs/}.
\bibitem{pgvector} pgvector, "pgvector: Open-source vector similarity search for Postgres," 2024. [Online]. Available: \url{https://github.com/pgvector/pgvector}.
\bibitem{supabase} Supabase, "Supabase Documentation," 2024. [Online]. Available: \url{https://supabase.com/docs}.
\bibitem{plantuml} PlantUML, "PlantUML Documentation," 2024. [Online]. Available: \url{https://plantuml.com/}.
\bibitem{gemini} Google DeepMind, "Gemini: A Family of Highly Capable Multimodal Models," 2023.
\bibitem{rag} Lewis, P., et al., "Retrieval-Augmented Generation for Knowledge-Intensive NLP Tasks," NeurIPS, 2020.
\end{thebibliography}

\end{document}