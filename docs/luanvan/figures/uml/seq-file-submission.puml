@startuml
title Quy trình nộp bài dạng tệp (File Submission)

actor "Học sinh" as Student
participant "Web UI\n(Next.js)" as UI
participant "API\n/submissions" as API
database "PostgreSQL" as DB
participant "Supabase Storage" as Storage

Student -> UI: Chọn tệp và nhấn "Nộp bài"
UI -> API: Tạo submission + yêu cầu signed upload URL
activate API
API -> API: Xác thực + kiểm tra quyền
API -> DB: Tạo bản ghi submission (pending)
DB --> API: submissionId
API -> Storage: Tạo signed URL (upload)
Storage --> API: signedUploadUrl
API --> UI: Trả về signedUploadUrl + submissionId
deactivate API

UI -> Storage: Upload file bằng signedUploadUrl
Storage --> UI: Upload OK

UI -> API: Xác nhận upload hoàn tất
activate API
API -> Storage: (Tuỳ chọn) verify object metadata
Storage --> API: file info
API -> DB: Lưu metadata (storagePath, sizeBytes, mimeType)
DB --> API: OK
API --> UI: Nộp bài thành công
deactivate API

@enduml
